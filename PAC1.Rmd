---
title: "PAC1_omica"
author: "Helena Álvarez Álvarez"
date: "`r Sys.Date()`"
output:
  word_document: default
  pdf_document: default
editor_options:
  word_document:
    toc: true
  markdown:
    wrap: 72
---
## Abstarct
En aquest treball s'analitza la base de dades GatricCancer_NMR, amb la qual es vol extreureun perfil metabòlic per diagnosticar el càncer gàstric, mitjançant l'objecte de classe SummarizedExperiment i fent un anàlisi exploratori, el qual inclou una PCA. 
En els resultats es veu que hi ha múltiples valors perduts i també veiem que no hi ha clusters difernciats i per tant, no es pot extreure un perfil metabòlomic únic per els pacients amb càncer gàstric a partir dels anàlisi realitzats en aquest treball.


## Introducció

L'objectiu d'aquest treball és realitzar, de manera general, un
procés d'anàlisis de dades òmiques utilitzant les eines introduides
durant el curs fins ara, en concret Bioconductor, git i l'exploració multivariant de dades òmique, per després poder fer una interpretació dels resultats des d'un punt de vista biològic.

## Material i mètodes

**Materials**

Per aquest treball s'ha utilitzat la base de dades anomenada
GatricCancer_NMR utilitzada en l'estudi de Chan et al. (2016), que ha
estat dipositada a Metabolomics Workbench data repository i
posteriorment utilitzada en el tutorial Basic Metabolomics Data Analysis
Workflow".

Es tracta d'una base de dades en el que intenten identificar un perfil
metabolomic urinari únic per la detecció de càncer gàstric. Hi ha un
total de 140 mostres de les quals 43 tenen cancer gàstric (GC), 40 tenen
malaltia gastrica benigna (BN), 40 son individus sans (HE) i 17 (QC) son
controls. A més, s'ha analitzat la concentració 77 metabolits diferents
(149 mostres de metabòlits en total, alguns repetits).

Hem triat aquesta base de dades degut a que és un dataset bastant
complet, amb informació addicional suficient per comprendre clarament
les dades i amb una mostra realtivament gran (140 mostres) per poder
extreure uns resultats concloents. A més, es tracta d'un tema
interessant, la perfilació metabòlica, amb la que si s'arriba a uns
resultats concloents podria ajudar a una detecció més temprana de la
malaltia, el que és de gran importància clínica.

S'ha utilitat la base de dades en format xlsx.

**Metòdes**

Per analitzar la base de dades s'ha utilitzat el software R studio amb
Bioconductor, utilitzant les llibreries: SummarizedExperiment, Biobase,
ggplot2, readxl, FactoMineR, factoextra i missMDA.

Primer s'han separat les dades en dos objectes, un anomenat data_df amb
la informació de les mostres i un altre amb l'informació sobre els
metabòlis (quin és cada), peak_df. Seguidament, hem convertit els
resultats de la concentració dels metabòlits en una matriu i hem fet dos
DataFrames, un amb la informació sobre les mostres (Idx, SampleID,
SampleType, Class) i un altre amb la informaciò dels metabòlits (Name,
Level).Finalement, hem creat l'objecte amb classe SummarizedEperiment,
que conté les dades i metadades, anomenat se_object i hem fet el fitxer
.Rda.

Un cop haviem creat l'objecte,hem fet un anàlisi exploratòria, per tenir
un coneixement general de les dades de la base de dades. Primer, hem fet
un resum general de l'objecte se_object i hem mirat quantes mostres hi
havia de cada classe (tipus d'individu). També hem analitzat el
percentatge de valors absents per mostra i s'ha fet una representació
amb un gràfic de barres. Finalment, hem fet un Anàlisis de componenets
Principals (PCA) per reduir la dimensionalitat de les dades, i hem
generat un gràfic per poder veure i entendre millor els resultats.

## Resultats

**Exercici 1**

```{r}
library(SummarizedExperiment)
library(Biobase)
library(ggplot2)
library(readxl)
library(FactoMineR)
library(factoextra)
library(missMDA)

data <- read_excel("GastricCancer_NMR.xlsx")

head(data)

```

Hem Carregat els pàquets necessaris per resoldre tota l'activitat, i
càrreguem les dades en format xlsx.

**Exercici 2**

```{r}
data_path <- "GastricCancer_NMR.xlsx"
data_df <- read_excel(data_path, sheet = "Data")
peak_df <- read_excel(data_path, sheet = "Peak")

metabolite_data <- as.matrix(data_df[, 5:ncol(data_df)])  
rownames(metabolite_data) <- data_df$SampleID 
metabolite_data <- t(metabolite_data)  


sample_info <- data_df[, 1:4]  
rownames(sample_info) <- data_df$SampleID
sample_info <- as.data.frame(sample_info)  
rownames(sample_info) <- sample_info$SampleID  


feature_info <- data.frame(peak_df[, c("Name", "Label")])  
rownames(feature_info) <- peak_df$Name

se_object <- SummarizedExperiment(
    assays = list(counts = metabolite_data),
    colData = sample_info,
    rowData = feature_info
)

save(se_object, file = "SummarizedExperiment_GastricCancer.Rda")


```

Generem un objecte a partir del document xlsx mitjançant
SummarizedExperiment.

ExpressionSet es va desenvolupar abans de SummarizedExperiment, i a més
es va dissenyar expressament per gestionar dades de microarrays, a
diferència que SummarizedExperiment que està pensada per esttuctures més
modernes amb alta dimensionalitat com RNA-seq. Els elements principls
també són diferents, en ExpressionSet son: exprs, pData, fData,
experimentData i annotation; mentre que en SummarizedExperiment son:
assay, colData, rowData i metadata. En general, SummarizedExperimet és
més flexible que ExpressionSet.

**Exercici 3**

```{r }
se_object
table(colData(se_object)$Class)

#Valors perduts per mostra
missing_data <- colMeans(is.na(assay(se_object)))
barplot(missing_data, main = "Percentatge de valors perduts per mostra")
mean_missing_data <- mean(missing_data)
mean_missing_data
missing_data_1 <- rowMeans(is.na(assay(se_object)))
barplot(missing_data_1, main = "Percentatge de valors perduts per matabòlit")

#PCA
corrected_data <- t(assay(se_object))
sum(is.na(corrected_data))
corrected_data[is.na(corrected_data)] <- apply(corrected_data, 2, mean, na.rm = TRUE)
corrected_data <- imputePCA(corrected_data, ncp = 2)
pca_result <- prcomp(corrected_data, scale = TRUE)

fviz_pca_ind(pca_result, label = "none", habillage = colData(se_object)$Class)
```

En se_objecte hi ha un total de 149 files que contenen els diferents
metabolits, i 140 columnes que són les diferents mostres dels infividus.
Trobem que en total hi ha un total de 1069 apartats amb valors absents.
El màxim d'una mostra amb valors absents és un 15%. I la mitjana de
valors perduts per cada individu és de 0,05. Veiem que tots els
individus tenen algun valor perdut mentre que no tots els metabòlits
tenen valors perduts, però hi ha que tenen bastants més, sent el màxim
0.3.

Veiem que en la PCA, el primer component explica un 21,9% de la
diversitat de les mostres, mentre que la segona indica 7,1%. Veiem també
que la majoria de mostres han format un cluster, menys algunes que es
troben individualment separades.

## Discussió

Veient els resultats no podem extreure cap conclusió definitiva. Podem
dir que hi ha més valors perduts per metabòlit que per mostra, el que es
lògic, ja que si mirem els noms dels metabòlits hi ha alguns repetits i
pot ser que en alguns dels casos no sempre s'hagi buscat aquet repetit,
ademès i ha més metabòlits que mostres i aconseguir les concentracions
de algun metabòlit en concret pot ser més complicat. Tot i això, veient
els resultat no hi ha cap mostra o cap metabòliten concret que tingui
una qualitat dolenta i s'agi hagut d'eliminar. Això és degut a que
aquestes dades ja han estat processades un cop((Metabolomics Workbench:
NIH Data Repository, s.f.) i per tant, és probable que les mostres de
més baixa qualitat ja hagin estat eliminades.

Per altra, banda podem dir que la PCA és poc indicativa. Això és degut a
varis motius, el primer és que els dos components, Dim1 i Dim2 expliquen
realtivament poc de la diversitat de la mostra, un 21,9% i un 7,1% és
menys del 30% de la diversitat. A més, no veiem clusters diferenciats
segons la classe de pacient, sino que, més aviat, hi ha un gran clúster
on s'agrupen la majoria de mostres, i només algunes concretes que estan
separades individualment.

Per aquests motius, amb només els primers anàlisis realitzats no podriem
dir que hi ha una diferencia clara en el perfil metabolomic de persones
amb càncer gastric. Tan mateix, els anàlisis realitzats només ens
proporcionen una visió general de le dades. Si entrem en més detall, com
fan en el article, s'ha vist que sí que tenen un perfil metabòlomic
diferent (Chan et al., 2016), el qual té  concretament tres metabòlits discriminatoris, 2-hydroxyisobutyrate, 3-indoxylsulfate, i alanine. La identificiació d'aquest perfil metabòlic pot tenir, en un futut, un potencial clinic perla perfilació metabòlica, la qual ajudaria a una detecció temprana de GC.

## Conclusió

D'aquest primer anàlisi exploratòria queda clar que les dades amb les que s'ha treballat han estat processades, ja que no sembla que hi hagi dades de baixa qualitat. El que no queda clar és si realment podem dir que hi hagi un perfil metabòlic determinat per persones amb càncer gàstric, ja que no veiem diferents clusters per les diferents classes de mòstres. Per anàlisis més profunds, utilitzant estadística univariant i multivariant, l'estudi de Chan et al., 2016, del quel provenen les dades, sí que han vist que hi ha un perfil mètabolic determinat, el qual té un gran potencial clínic. 

## Bibliografia

Chan, A., Mercier, P., Schiller, D. et al. 1H-NMR urinary metabolomic
profiling for diagnosis of gastric cancer. Br J Cancer 114, 59–62
(2016). <https://doi.org/10.1038/bjc.2015.414>

Metabolomics Workbench: NIH Data Repository. (s.f.).
<https://www.metabolomicsworkbench.org/data/DRCCMetadata.php?Mode=Project&ProjectID=PR000699>

Tutorial1: basic Metabolomics Data Workflow. (s. f.).
<https://cimcb.github.io/MetabWorkflowTutorial/Tutorial1.html>
